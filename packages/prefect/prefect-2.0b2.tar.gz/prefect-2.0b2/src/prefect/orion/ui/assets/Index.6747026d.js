import{e as j,k as C,f as n,l as q,az as ie,o as i,g as E,H as ce,aY as J,r as I,c as d,d as s,a as r,w as c,u as t,aX as _e,ai as K,aZ as Q,a_ as de,h as k,I as h,a$ as pe,b0 as fe,b1 as me,b2 as ve,aV as ye,aA as he,aU as ge,b3 as we,F as be,i as ke,t as y,a6 as xe}from"./vendor.20f3e3c2.js";import{R as Re,M as $e}from"./Radar.bbf8addf.js";import{A as x,E as R,s as ee,S as Fe,f as te}from"./index.fdb75d7c.js";import{T as Ie}from"./Timeline.42bcbc63.js";const Le=j({props:{id:null},setup(L){const g=L,w=C(new Re),m=n(()=>({id:g.id})),v={radar:x.query({endpoint:R.radar,body:m,options:{pollInterval:5e3}})};return q(()=>{var a;return(a=v.radar.response)==null?void 0:a.value},a=>{a&&w.value.items(a)}),ie(()=>{w.value.id("id").dependencies("upstream_dependencies").items([])}),(a,B)=>(i(),E($e,{id:L.id,radar:w.value,"hide-viewport":"","disable-interactions":""},null,8,["id","radar"]))}});const Se={class:"flow-run-logs-tabs-content"},Ne={class:"flow-run-logs-tabs-content__header"},Te=h(" Copy Logs "),Ce={class:"flow-run-logs-tab-content__table"},qe=pe('<div class="flow-run-logs-tab-content__table-header"><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--level"> Level </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--time"> Time </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column--message"> Message </span><span class="flow-run-logs-tab-content__column flow-run-logs-tab-content__column-run"> Run name </span></div>',1),Be={class:"flow-run_logs-tab-content__empty"},De=h(" No logs to show. "),Ve=h(" Try clearing your filter "),Ee={key:0,class:"flow-run-logs-tabs-content__loading"},Ae=j({props:{flowRunId:{type:String,required:!0},running:{type:Boolean}},setup(L){const g=L,w=C(),m=[{label:"Critical only",value:50},{label:"Error and above",value:40},{label:"Warning and above",value:30},{label:"Info and above",value:20},{label:"Debug and above",value:10},{label:"All log levels",value:0}],v=C(0),a=n(()=>({logs:{flow_run_id:{any_:[g.flowRunId]},level:{ge_:v.value}}})),B={interval:g.running?5e3:void 0},p=ce(J.getLogs.bind(J),[a],B),D=n(()=>{var o;return(o=p.response.value)!=null?o:[]}),S=n(()=>{var o;return(o=p.loading.value)!=null?o:!0}),N=()=>{v.value=0},A=()=>{if(!w.value)return;const o=w.value,b=o.scrollTop>0,$=o.scrollTop+o.offsetHeight===o.scrollHeight;b&&$&&fe(()=>{o.scrollTop=o.scrollHeight})},U=()=>D.value.map(o=>{const b=me(o.level),$=ve(o.timestamp);return`${b}	${$}	${o.message}`}).join(`
`);return q(()=>g.running,()=>p.unsubscribe()),q(()=>p.response.value,()=>A()),(o,b)=>{const $=I("m-select"),l=I("m-button"),V=I("m-loader");return i(),d("div",Se,[s("div",Ne,[r($,{modelValue:v.value,"onUpdate:modelValue":b[0]||(b[0]=F=>v.value=F),options:m,class:"flow-run-logs-tabs-content__filter"},null,8,["modelValue"]),r(t(_e),{text:"",value:U,class:"flow-run-logs__copy",toast:"Logs copied to clipboard"},{default:c(()=>[Te]),_:1})]),s("div",Ce,[qe,s("div",{ref_key:"logsRef",ref:w,class:"flow-run-logs-tab-content__logs"},[r(t(de),{logs:t(D)},{empty:c(()=>[s("p",Be,[De,K(r(l,{class:"ml-2",onClick:N},{default:c(()=>[Ve]),_:1},512),[[Q,v.value]])])]),_:1},8,["logs"]),L.running||t(S)?(i(),d("div",Ee,[r(V,{loading:!0,class:"flow-run-logs-tabs-content__loader"}),K(s("span",null,"Run in progress...",512),[[Q,L.running]])])):k("",!0)],512)])])}}});const Ue={class:"main-grid"},He={class:"d-flex align-center justify-space-between py-1 px-2"},Me={class:"d-inline-flex flex-column"},Pe={class:"flex-grow-0 flex-shrink-1"},je={class:"d-inline-flex align-center text-truncate"},Ge={class:"caption font--primary font-weight-semibold text--grey-40 d-flex text-truncate"},We={key:0},ze=h(" Started: "),Oe={class:"text--grey-80 mr-1 ml--half"},Xe={key:1},Ye=h(" Ended: "),Ze={class:"text--grey-80 mr-1 ml--half"},Je={class:"caption font--primary font-weight-semibold text--grey-40 mt-1 d-flex text-truncate"},Ke={key:0},Qe=h(" Deployment: "),et={class:"text--grey-80 mr-1 ml--half"},tt={key:1},st=h(" Parent: "),nt={class:"text--grey-80"},ot=h(" /"),lt={key:2},at=h(" Results: "),rt={class:"text--grey-80 mr-1 ml--half"},ut={key:3},it=h(" Flow version: "),ct={class:"text--grey-80 mr-1 ml--half"},_t={class:"font--secondary"},dt={class:"d-flex align-center justify-space-between py-1 px-2"},pt=s("div",{class:"subheader"}," Timeline ",-1),ft={class:"timeline-content pb-2 px-2 d-flex flex-grow-1"},mt={class:"d-flex align-center justify-space-between py-1 px-2"},vt=s("div",{class:"subheader"}," Radar ",-1),yt={class:"radar-content pb-2 px-2 d-flex flex-grow-1"},ht={key:0,class:"flow-run__tab-badge caption"},gt={class:"font--secondary caption my-2",style:{"min-height":"17px"}},wt={key:0},bt={class:"results-section"},kt={key:1,class:"text-center my-8"},xt=s("h2",null,"No results found",-1),Rt=[xt],$t={class:"results-section"},Ft={key:1,class:"text-center my-8"},It=s("h2",null,"No results found",-1),Lt=[It],St={class:"flow-run__tab-content"},Nt=s("hr",{class:"results-hr mt-3"},null,-1),Dt=j({async setup(L){let g,w;const m=ke(),v=C("logs"),a=C(m==null?void 0:m.params.id),B=n(()=>({id:a.value})),p=([g,w]=ye(()=>x.query({endpoint:R.flow_run,body:B,options:{pollInterval:5e3}}).fetch()),g=await g,w(),g),D=n(()=>p.response.value.flow_id),S=n(()=>p.response.value.parent_task_run_id),N=n(()=>p.response.value.deployment_id),A=n(()=>({id:D.value})),U=n(()=>({id:N.value})),o=n(()=>({task_runs:{id:{any_:[S.value]}}})),b=n(()=>({flow_runs:{id:{any_:[a.value]}}})),$=n(()=>({flow_runs:{id:{any_:[a.value]}},task_runs:{subflow_runs:{exists_:!0}}})),l={flow:x.query({endpoint:R.flow,body:A}),deployment:x.query({endpoint:R.deployment,body:U,options:{paused:!N.value}}),parent_flow:x.query({endpoint:R.flows,body:o,options:{paused:!S.value}}),parent_flow_run:x.query({endpoint:R.flow_runs,body:o,options:{paused:!S.value}}),task_runs_count:x.query({endpoint:R.task_runs_count,body:b,options:{pollInterval:1e4}}),task_runs:x.query({endpoint:R.task_runs,body:b,options:{pollInterval:1e4}}),sub_flow_runs_count:x.query({endpoint:R.task_runs_count,body:$,options:{pollInterval:1e4}})};function V(e){return typeof G.value[e]=="number"}const F=e=>{var u;return(u=G.value[e])!=null?u:0},G=n(()=>{var e,u;return{task_runs:(e=l.task_runs_count.response)==null?void 0:e.value,sub_flow_runs:(u=l.sub_flow_runs_count.response)==null?void 0:u.value,logs:void 0}}),H=n(()=>{var e;return((e=l.deployment.response)==null?void 0:e.value)||{}}),W=n(()=>{var e,u;return((u=(e=l.parent_flow.response)==null?void 0:e.value)==null?void 0:u[0])||{}}),z=n(()=>{var e,u;return((u=(e=l.parent_flow_run.response)==null?void 0:e.value)==null?void 0:u[0])||{}}),O=n(()=>{var e,u;return(u=(e=H.value)==null?void 0:e.flow_data)==null?void 0:u.blob}),f=n(()=>{var e;return((e=p.response)==null?void 0:e.value)||{}}),se=n(()=>f.value.end_time),T=n(()=>{var e;return(e=f.value)==null?void 0:e.state}),ne=n(()=>T.value.type=="RUNNING"),oe=n(()=>{var e;return((e=f.value)==null?void 0:e.tags)||[]});n(()=>{var e;return((e=l.task_runs_count.response)==null?void 0:e.value)||0}),n(()=>{var e;return((e=l.sub_flow_runs_count.response)==null?void 0:e.value)||0});const X=n(()=>{var e;return((e=l.task_runs.response)==null?void 0:e.value)||[]}),le=[{title:"Task Runs",key:"task_runs",icon:"pi-task"},{title:"Subflow Runs",key:"sub_flow_runs",icon:"pi-flow-run"},{title:"Logs",key:"logs",icon:"pi-logs-fill"}],ae=n(()=>T.value.type=="PENDING"||T.value.type=="SCHEDULED"?"--":f.value.total_run_time?ee(f.value.total_run_time):ee(f.value.estimated_run_time));he(()=>{p.stopPolling(),x.queries.delete(p.id)});const re=q(m,()=>{a.value=m==null?void 0:m.params.id});return ge(()=>{re()}),q(a,async()=>{!a.value||(await p.fetch(),l.flow.fetch(),l.task_runs_count.fetch(),l.task_runs.fetch(),l.sub_flow_runs_count.fetch(),N.value?l.deployment.fetch():l.deployment.clearResult(),S.value?l.parent_flow.fetch():l.parent_flow.clearResult(),S.value?l.parent_flow_run.fetch():l.parent_flow_run.clearResult(),v.value="task_runs")}),(e,u)=>{const ue=I("m-tags"),M=I("router-link"),P=I("m-card"),Y=I("m-icon-button"),Z=I("ResultsList");return i(),d(be,null,[s("div",Ue,[r(P,{class:"details",shadow:"sm"},{default:c(()=>[s("div",He,[s("div",Me,[s("div",Pe,[s("span",je,[r(Fe,{name:t(T).name,type:t(T).type,class:"mr-1"},null,8,["name","type"]),r(ue,{tags:t(oe),class:"mr-1 caption"},null,8,["tags"]),s("div",Ge,[t(f).start_time?(i(),d("span",We,[ze,s("span",Oe,y(t(te)(t(f).start_time)),1)])):k("",!0),t(f).end_time?(i(),d("span",Xe,[Ye,s("span",Ze,y(t(te)(t(f).end_time)),1)])):k("",!0)])])]),s("div",Je,[t(H).name?(i(),d("span",Ke,[Qe,s("span",et,y(t(H).name),1)])):k("",!0),t(W).name?(i(),d("span",tt,[st,s("span",nt,y(t(W).name),1),ot,r(M,{to:`/flow-run/${t(z).id}`,class:"mr-1 ml--half text--primary"},{default:c(()=>[h(y(t(z).name),1)]),_:1},8,["to"])])):k("",!0),t(O)?(i(),d("span",lt,[at,s("span",rt,y(t(O)),1)])):k("",!0),t(f).flow_version?(i(),d("span",ut,[it,s("span",ct,y(t(f).flow_version),1)])):k("",!0)])]),s("div",_t,y(t(ae)),1)])]),_:1}),r(P,{class:"timeline d-flex flex-column",width:"auto",shadow:"sm"},{header:c(()=>[s("div",dt,[pt,r(M,{to:`/flow-run/${a.value}/timeline`},{default:c(()=>[r(Y,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[s("div",ft,[t(X).length?(i(),E(Ie,{key:0,items:t(X),"max-end-time":t(se),"hide-header":"","axis-position":"bottom","background-color":"blue-5"},null,8,["items","max-end-time"])):k("",!0)])]),_:1}),r(P,{class:"radar",shadow:"sm"},{header:c(()=>[s("div",mt,[vt,r(M,{to:`/flow-run/${a.value}/radar`},{default:c(()=>[r(Y,{icon:"pi-full-screen"})]),_:1},8,["to"])])]),default:c(()=>[s("div",yt,[r(Le,{id:a.value},null,8,["id"])])]),_:1})]),r(t(we),{value:v.value,"onUpdate:value":u[0]||(u[0]=_=>v.value=_),tabs:le,class:"mt-3"},{"after-tab":c(({tab:_})=>[V(_.key)?(i(),d("span",ht,y(F(_.key).toLocaleString()),1)):k("",!0)]),"before-tab-content":c(({selectedTab:_})=>[s("div",gt,[V(_.key)&&F(_.key)>0?(i(),d("span",wt,y(F(_.key).toLocaleString())+" "+y(t(xe)("Result",F(_.key))),1)):k("",!0)])]),task_runs:c(({tab:_})=>[s("section",bt,[F(_.key)>0?(i(),E(Z,{key:"task_runs",filter:t(b),component:"ListItemTaskRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(i(),d("div",kt,Rt))])]),sub_flow_runs:c(({tab:_})=>[s("section",$t,[F(_.key)>0?(i(),E(Z,{key:"sub_flow_runs",filter:t($),component:"ListItemSubFlowRun",endpoint:"task_runs","poll-interval":5e3},null,8,["filter"])):(i(),d("div",Ft,Lt))])]),logs:c(()=>[s("section",St,[r(Ae,{"flow-run-id":a.value,running:t(ne)},null,8,["flow-run-id","running"])])]),_:1},8,["value"]),Nt],64)}}});export{Dt as default};

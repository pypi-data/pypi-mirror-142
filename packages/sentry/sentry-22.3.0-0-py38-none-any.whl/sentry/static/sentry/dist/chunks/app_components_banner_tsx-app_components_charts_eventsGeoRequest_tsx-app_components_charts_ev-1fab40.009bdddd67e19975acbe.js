"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_banner_tsx-app_components_charts_eventsGeoRequest_tsx-app_components_charts_ev-1fab40"],{"./app/actionCreators/discoverSavedQueries.tsx":(e,t,r)=>{r.d(t,{Yi:()=>o,GH:()=>n,M6:()=>d,EQ:()=>u,qF:()=>c});var a=r("./app/actionCreators/indicator.tsx"),s=r("./app/api.tsx"),i=r("./app/locale.tsx");function o(e,t,r){const s=e.requestPromise(`/organizations/${t}/discover/saved/${r}/`,{method:"GET"});return s.catch((()=>{(0,a.Iw)((0,i.t)("Unable to load saved query"))})),s}function n(e,t,r){const s=e.requestPromise(`/organizations/${t}/discover/saved/`,{method:"POST",data:r});return s.catch((()=>{(0,a.Iw)((0,i.t)("Unable to create your saved query"))})),s}function d(e,t,r){const s=e.requestPromise(`/organizations/${t}/discover/saved/${r.id}/`,{method:"PUT",data:r});return s.catch((()=>{(0,a.Iw)((0,i.t)("Unable to update your saved query"))})),s}function u(e,t){return(new s.KU).requestPromise(`/organizations/${e}/discover/saved/${t}/visit/`,{method:"POST"})}function c(e,t,r){const s=e.requestPromise(`/organizations/${t}/discover/saved/${r}/`,{method:"DELETE"});return s.catch((()=>{(0,a.Iw)((0,i.t)("Unable to delete the saved query"))})),s}},"./app/components/banner.tsx":(e,t,r)=>{r.d(t,{Z:()=>b});var a=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),i=r("../node_modules/@emotion/react/dist/emotion-react.browser.esm.js"),o=r("./app/components/button.tsx"),n=r("./app/components/buttonBar.tsx"),d=r("./app/icons/index.tsx"),u=r("./app/locale.tsx"),c=r("./app/styles/space.tsx"),l=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const p=e=>`${e}-banner-dismissed`;function m(e){localStorage.setItem(p(e),"true")}const v=e=>{let{title:t,subtitle:r,isDismissable:a=!0,dismissKey:i="generic-banner",className:o,backgroundImg:n,backgroundComponent:d,children:c}=e;const[v,b]=function(e){const t=p(e),[r,a]=s.useState(localStorage.getItem(t));return["true"===r,()=>{a("true"),m(e)}]}(i);return v?null:(0,l.BX)(g,{backgroundImg:n,className:o,children:[d,a?(0,l.tZ)(f,{onClick:b,"aria-label":(0,u.t)("Close")}):null,(0,l.BX)(h,{children:[(0,l.tZ)(y,{children:t}),(0,l.tZ)(D,{children:r}),(0,l.tZ)(_,{gap:1,children:c})]})]})};v.displayName="Banner",v.dismiss=m;const g=(0,a.Z)("div",{target:"e8az5815"})((e=>e.backgroundImg?(0,i.iv)("background:url(",e.backgroundImg,");background-repeat:no-repeat;background-size:cover;background-position:center center;",""):(0,i.iv)("background-color:",e.theme.gray500,";",""))," display:flex;overflow:hidden;align-items:center;justify-content:center;position:relative;margin-bottom:",(0,c.Z)(2),";box-shadow:",(e=>e.theme.dropShadowLight),";border-radius:",(e=>e.theme.borderRadius),";height:180px;color:",(e=>e.theme.white),";@media (min-width: ",(e=>e.theme.breakpoints[0]),"){height:220px;}"),h=(0,a.Z)("div",{target:"e8az5814"})("position:absolute;display:grid;justify-items:center;grid-template-rows:repeat(3, max-content);text-align:center;padding:",(0,c.Z)(4),";"),y=(0,a.Z)("h1",{target:"e8az5813"})("margin:0;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){font-size:40px;}"),D=(0,a.Z)("div",{target:"e8az5812"})("margin:0;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){font-size:",(e=>e.theme.fontSizeExtraLarge),";}"),_=(0,a.Z)(n.ZP,{target:"e8az5811"})("margin-top:",(0,c.Z)(2),";width:fit-content;"),f=(0,a.Z)(o.ZP,{target:"e8az5810"})("position:absolute;display:block;top:",(0,c.Z)(2),";right:",(0,c.Z)(2),";color:",(e=>e.theme.white),";cursor:pointer;z-index:1;");f.defaultProps={icon:(0,l.tZ)(d.bM,{}),"aria-label":(0,u.t)("Close"),priority:"link",borderless:!0,size:"xsmall"};const b=v},"./app/components/charts/eventsGeoRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>n}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var a=r("../node_modules/react/index.js"),s=r("./app/utils/dates.tsx"),i=r("./app/utils/discover/eventView.tsx"),o=r("./app/utils/discover/genericDiscoverQuery.tsx");const n=e=>{let{api:t,organization:r,yAxis:n,query:d,orderby:u,projects:c,period:l,start:p,end:m,environments:v,referrer:g,children:h}=e;const y=i.ZP.fromSavedQuery({id:void 0,name:"",version:2,fields:Array.isArray(n)?n:[n],query:d,orderby:null!=u?u:"",projects:c,range:null!=l?l:"",start:p?(0,s.v5)(p):void 0,end:m?(0,s.v5)(m):void 0,environment:v}),[D,_]=(0,a.useState)(void 0),[f,b]=(0,a.useState)(!1),[q,x]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{let e=!0;return x(!1),D&&b(!0),(0,o.AA)(t,`/organizations/${r.slug}/events-geo/`,{...y.generateQueryStringObject(),referrer:g}).then((t=>{e&&(_([t[0]]),b(!1))})).catch((()=>{e&&(x(!0),b(!1))})),()=>{e=!1}}),[d,n,p,m,l,v,c]),h({errored:q,loading:!D&&!q,reloading:f,tableData:D})}},"./app/components/charts/eventsRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>f});var a=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=(r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),i=r("../node_modules/lodash/isEqual.js"),o=r.n(i),n=r("../node_modules/lodash/omitBy.js"),d=r.n(n),u=r("./app/actionCreators/events.tsx"),c=r("./app/actionCreators/indicator.tsx"),l=r("./app/components/charts/loadingPanel.tsx"),p=r("./app/components/charts/utils.tsx"),m=r("./app/locale.tsx"),v=r("./app/utils.tsx"),g=r("./app/utils/discover/fields.tsx"),h=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const y=["api","children","organization","loading","queryBatching","generatePathname"],D=e=>d()(e,((e,t)=>y.includes(t)));class _ extends s.PureComponent{constructor(){super(...arguments),(0,a.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,a.Z)(this,"unmounting",!1),(0,a.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,onError:r,expired:a,name:s,hideError:i,...o}=this.props;let n,d=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),a)n=(0,m.t)("%s has an invalid date range. Please try a more recent date range.",s),(0,c.Iw)(n,{append:!0}),this.setState({errored:!0,errorMessage:n});else try{e.clear(),d=await(0,u.lI)(e,o)}catch(e){n=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,m.t)("Error loading chart data"),i||(0,c.Iw)(n),r&&r(n),this.setState({errored:!0,errorMessage:n})}this.unmounting||this.setState({reloading:!1,timeseriesData:d,fetchedWithPrevious:o.includePrevious})}})),(0,a.Z)(this,"getData",(e=>{const{fetchedWithPrevious:t}=this.state,{period:r,includePrevious:a}=this.props,s=t||(0,p.Sw)(a,r),i=Math.floor(e.length/2);return{current:s?e.slice(i):e,previous:s?e.slice(0,i):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){o()(D(e),D(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>1e3*e;return e.map(((e,r)=>{let[a,s]=e;return{name:t(a,s,r),value:s.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}transformPreviousPeriodData(e,t,r){return t?{seriesName:null!=r?r:"Previous",data:this.calculateTotalsPerTimestamp(t,((t,r,a)=>1e3*e[a][0])),stack:"previous"}:null}transformAggregatedTimeseries(e){return{seriesName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t){return[{seriesName:t||"Current",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{comparisonCount:r}=t;return e+(null!=r?r:0)}),0)}}))}]}processData(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;const{data:s,isMetricsData:i,totals:o}=e,{includeTransformedData:n,includeTimeAggregation:d,timeAggregationSeriesName:u,currentSeriesNames:c,previousSeriesNames:l,comparisonDelta:m}=this.props,{current:v,previous:g}=this.getData(s);return{data:n?this.transformTimeseriesData(v,null!=a?a:null==c?void 0:c[r]):[],comparisonData:n&&m?this.transformComparisonTimeseriesData(v):[],allData:s,originalData:v,totals:o,isMetricsData:i,originalPreviousData:g,previousData:n?this.transformPreviousPeriodData(v,g,null!==(t=a?(0,p.TE)(a):void 0)&&void 0!==t?t:null==l?void 0:l[r]):null,timeAggregatedData:d?this.transformAggregatedTimeseries(v,u||""):{},timeframe:e.start&&e.end?g?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...r}=this.props,{topEvents:a}=this.props,{timeseriesData:s,reloading:i,errored:o,errorMessage:n}=this.state,d=this.props.loading||null===s;if(t&&d)return(0,h.tZ)(l.Z,{"data-test-id":"events-request-loading"});if((0,p.Xe)(s,(0,v.ri)(a))){let t;const a={},u=Object.keys(s).map(((e,r)=>{const i=s[e],o=this.processData(i,r,(0,g.bQ)(e));return t||(t=o.timeframe),o.isMetricsData&&(a[e]={isMetricsData:o.isMetricsData}),[i.order||0,o.data[0],o.previousData,{isMetricsData:o.isMetricsData}]})).sort(((e,t)=>e[0]-t[0])),c=u.map((e=>e[1])),l=u.some((e=>null===e[2]))?void 0:u.map((e=>e[2]));return e({loading:d,reloading:i,errored:o,errorMessage:n,results:c,timeframe:t,previousTimeseriesData:l,seriesAdditionalInfo:a,...r})}if(s){var u,c;const{data:t,comparisonData:a,allData:l,originalData:p,totals:m,originalPreviousData:v,previousData:g,timeAggregatedData:h,timeframe:y,isMetricsData:D}=this.processData(s);return e({loading:d,reloading:i,errored:o,errorMessage:n,seriesAdditionalInfo:{[null!==(u=null===(c=this.props.currentSeriesNames)||void 0===c?void 0:c[0])&&void 0!==u?u:"current"]:{isMetricsData:D}},timeseriesData:t,comparisonTimeseriesData:a,allTimeseriesData:l,originalTimeseriesData:p,timeseriesTotals:m,originalPreviousTimeseriesData:v,previousTimeseriesData:g?[g]:g,timeAggregatedData:h,timeframe:y,...r})}return e({loading:d,reloading:i,errored:o,errorMessage:n,...r})}}_.displayName="EventsRequest",(0,a.Z)(_,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const f=_},"./app/views/dashboardsV2/types.tsx":(e,t,r)=>{r.d(t,{ZU:()=>a,$V:()=>s,FO:()=>i,l9:()=>o,n3:()=>n,EN:()=>d});const a=30,s=5;let i,o,n,d;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.TABLE="table",e.WORLD_MAP="world_map",e.BIG_NUMBER="big_number",e.STACKED_AREA="stacked_area",e.TOP_N="top_n"}(i||(i={})),function(e){e.DISCOVER="discover",e.ISSUE="issue",e.METRICS="metrics"}(o||(o={})),function(e){e.VIEW="view",e.EDIT="edit",e.CREATE="create",e.PENDING_DELETE="pending_delete",e.PREVIEW="preview"}(n||(n={})),function(e){e.DISCOVERV2="discoverv2",e.DASHBOARDS="dashboards",e.LIBRARY="library",e.ISSUE_DETAILS="issueDetail"}(d||(d={}))},"./app/views/eventsV2/savedQuery/utils.tsx":(e,t,r)=>{r.d(t,{b2:()=>u,O$:()=>p,pb:()=>m,Uc:()=>v,zz:()=>y});var a=r("./app/actionCreators/discoverSavedQueries.tsx"),s=r("./app/actionCreators/indicator.tsx"),i=r("./app/locale.tsx"),o=r("./app/utils/analytics.tsx"),n=r("./app/utils/discover/types.tsx"),d=r("./app/views/dashboardsV2/types.tsx");function u(e,t,r,n){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const u=r.toNewQuery();u.yAxis=n,(0,o.ec)({...g(d,"request"),organization_id:parseInt(t.id,10),...h(u)});const c=(0,a.GH)(e,t.slug,u);return c.then((e=>((0,s.S9)((0,i.t)("Query saved")),(0,o.ec)({...g(d,"success"),organization_id:parseInt(t.id,10),...h(u)}),e))).catch((e=>{(0,s.Iw)((0,i.t)("Query not saved")),(0,o.ec)({...g(d,"failed"),organization_id:parseInt(t.id,10),...h(u),error:e&&e.message||`Could not save a ${d?"new":"existing"} query`})})),c}const c={request:"Discoverv2: Request to save a saved query as a new query",success:"Discoverv2: Successfully saved a saved query as a new query",failed:"Discoverv2: Failed to save a saved query as a new query"},l={request:"Discoverv2: Request to save a new query",success:"Discoverv2: Successfully saved a new query",failed:"Discoverv2: Failed to save a new query"};function p(e,t,r,n){const d=r.toNewQuery();if(d.yAxis=n,!r.name)return(0,s.Iw)((0,i.t)("Please name your query")),Promise.reject();(0,o.ec)({eventKey:"discover_v2.update_query_request",eventName:"Discoverv2: Request to update a saved query",organization_id:parseInt(t.id,10),...h(d)});const u=(0,a.M6)(e,t.slug,d);return u.then((e=>((0,s.S9)((0,i.t)("Query updated")),(0,o.ec)({eventKey:"discover_v2.update_query_success",eventName:"Discoverv2: Successfully updated a saved query",organization_id:parseInt(t.id,10),...h(d)}),e))).catch((e=>{(0,s.Iw)((0,i.t)("Query not updated")),(0,o.ec)({eventKey:"discover_v2.update_query_failed",eventName:"Discoverv2: Failed to update a saved query",organization_id:parseInt(t.id,10),...h(d),error:e&&e.message||"Failed to update a query"})})),u}function m(e,t,r){const n=r.toNewQuery();(0,o.ec)({eventKey:"discover_v2.update_query_name_request",eventName:"Discoverv2: Request to update a saved query's name",organization_id:parseInt(t.id,10),...h(n)});const d=(0,a.M6)(e,t.slug,n);return d.then((e=>{(0,s.S9)((0,i.t)("Query name saved")),(0,o.ec)({eventKey:"discover_v2.update_query_name_success",eventName:"Discoverv2: Successfully updated a saved query's name",organization_id:parseInt(t.id,10),...h(n)})})).catch((e=>{(0,s.Iw)((0,i.t)("Query name not saved")),(0,o.ec)({eventKey:"discover_v2.update_query_failed",eventName:"Discoverv2: Failed to update a saved query's name",organization_id:parseInt(t.id,10),...h(n),error:e&&e.message||"Failed to update a query name"})})),d}function v(e,t,r){(0,o.ec)({eventKey:"discover_v2.delete_query_request",eventName:"Discoverv2: Request to delete a saved query",organization_id:parseInt(t.id,10),...h(r.toNewQuery())});const n=(0,a.qF)(e,t.slug,r.id);return n.then((()=>{(0,s.S9)((0,i.t)("Query deleted")),(0,o.ec)({eventKey:"discover_v2.delete_query_success",eventName:"Discoverv2: Successfully deleted a saved query",organization_id:parseInt(t.id,10),...h(r.toNewQuery())})})).catch((e=>{(0,s.Iw)((0,i.t)("Query not deleted")),(0,o.ec)({eventKey:"discover_v2.delete_query_failed",eventName:"Discoverv2: Failed to delete a saved query",organization_id:parseInt(t.id,10),...h(r.toNewQuery()),error:e&&e.message||"Failed to delete query"})})),n}function g(e,t){return{eventKey:e?"discover_v2.save_new_query_"+t:"discover_v2.save_existing_query_"+t,eventName:e?l[t]:c[t]}}function h(e){const{projects:t,fields:r,query:a}=e;return{projects:t,fields:r,query:a}}function y(e){switch(e){case n.DC.BAR:return d.FO.BAR;case n.DC.WORLDMAP:return d.FO.WORLD_MAP;case n.DC.TOP5:return d.FO.TOP_N;default:return d.FO.LINE}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_banner_tsx-app_components_charts_eventsGeoRequest_tsx-app_components_charts_ev-1fab40.23c5f195beb860a6cb8464cc04d19c42.js.map
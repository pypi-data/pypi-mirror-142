"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_alerts_rules_index_tsx"],{"./app/components/alertBadge.tsx":(e,t,s)=>{s.d(t,{Z:()=>c});var a=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),r=s("./app/icons/index.tsx"),n=s("./app/locale.tsx"),i=s("./app/styles/space.tsx"),o=s("./app/views/alerts/types.tsx"),l=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function d(e){let{status:t,hideText:s=!1,isIssue:a}=e,i=(0,n.t)("Resolved"),d=r.DL,c="green300";return a?(i=(0,n.t)("Issue"),d=r.XI,c="gray300"):t===o.vt.CRITICAL?(i=(0,n.t)("Critical"),d=r.zC,c="red300"):t===o.vt.WARNING&&(i=(0,n.t)("Warning"),d=r.qV,c="yellow300"),(0,l.BX)(p,{"data-test-id":"alert-badge",children:[(0,l.BX)(u,{color:c,icon:d,children:[(0,l.tZ)(m,{color:c}),(0,l.tZ)(d,{color:"white"})]}),!s&&(0,l.tZ)(h,{color:c,children:i})]})}d.displayName="AlertBadge";const c=d,p=(0,a.Z)("div",{target:"ef4c9wd3"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),u=(0,a.Z)("div",{target:"ef4c9wd2"})("width:36px;height:36px;position:relative;svg:last-child{width:",(e=>e.icon===r.XI?"13px":"16px"),";z-index:2;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;}"),m=(0,a.Z)(r.Sq,{target:"ef4c9wd1"})({name:"bgbjt4",styles:"width:36px;height:36px"}),h=(0,a.Z)("div",{target:"ef4c9wd0"})("margin-left:",(0,i.Z)(1),";")},"./app/views/alerts/rules/index.tsx":(e,t,s)=>{s.r(t),s.d(t,{default:()=>ie});var a=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),i=s("../node_modules/lodash/flatten.js"),o=s.n(i),l=s("./app/actionCreators/indicator.tsx"),d=s("./app/components/asyncComponent.tsx"),c=s("./app/components/layouts/thirds.tsx"),p=s("./app/components/links/externalLink.tsx"),u=s("./app/components/links/link.tsx"),m=s("./app/components/organizations/pageFilters/container.tsx"),h=s("./app/components/pagination.tsx"),g=s("./app/components/panels/index.tsx"),x=s("./app/components/sentryDocumentTitle.tsx"),Z=s("./app/icons/index.tsx"),v=s("./app/locale.tsx"),y=s("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),w=s("./app/utils/projects.tsx"),f=s("./app/utils/teams.tsx"),b=s("./app/utils/withPageFilters.tsx"),I=s("./app/views/alerts/filterBar.tsx"),C=s("./app/views/alerts/list/header.tsx"),A=s("./app/views/alerts/utils/index.tsx"),q=s("../node_modules/lodash/memoize.js"),L=s.n(q),T=s("./app/components/acl/access.tsx"),_=s("./app/components/alertBadge.tsx"),j=s("./app/components/avatar/actorAvatar.tsx"),z=s("./app/components/confirm.tsx"),B=s("./app/components/dateTime.tsx"),R=s("./app/components/dropdownMenuControlV2.tsx"),k=s("./app/components/errorBoundary.tsx"),S=s("./app/components/idBadge/index.tsx"),$=s("./app/components/timeSince.tsx"),D=s("./app/components/tooltip.tsx"),E=s("./app/styles/overflowEllipsis.tsx"),N=s("./app/styles/space.tsx"),G=s("./app/utils/getDynamicText.tsx"),X=s("./app/views/alerts/incidentRules/types.tsx"),F=s("./app/views/alerts/types.tsx"),V=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const W=L()(((e,t)=>t.find((t=>t.slug===e))));function O(e){var t,s,a,r,n;let{rule:i,organization:o,projectsLoaded:l,projects:d,orgId:c,onDelete:p,userTeams:m}=e;const h=void 0!==(null===(t=i.latestIncident)||void 0===t?void 0:t.status)&&[F.vt.CRITICAL,F.vt.WARNING].includes(i.latestIncident.status),g=i.projects[0],x=`/organizations/${c}/alerts/${(0,A.Gm)(i)?"rules":"metric-rules"}/${g}/${i.id}/`,y=`/organizations/${c}/alerts/rules/details/${i.id}/`,w=null===(s=i.owner)||void 0===s?void 0:s.split(":")[1],f=w?{type:"team",id:w,name:""}:null,b=!w||m.has(w),I=o.features.includes("alert-rule-status-page"),C=(0,A.Gm)(i)?I?(0,V.tZ)(u.Z,{to:`/organizations/${c}/alerts/rules/${i.projects[0]}/${i.id}/details/`,children:i.name}):i.name:(0,V.tZ)(P,{to:(0,A.Gm)(i)?x:y,children:i.name}),q={[F.vt.CRITICAL]:(0,v.t)("Critical"),[F.vt.WARNING]:(0,v.t)("Warning"),[F.vt.CLOSED]:(0,v.t)("Resolved"),[F.vt.OPENED]:(0,v.t)("Resolved")},L=[{key:"edit",label:(0,v.t)("Edit"),to:x},{key:"delete",label:(0,v.t)("Delete"),priority:"danger",onAction:()=>{(0,z._)({onConfirm:()=>p(g,i),header:(0,v.t)("Delete Alert Rule?"),message:(0,v._N)("Are you sure you want to delete [name]? You won't be able to view the history of this alert once it's deleted.",{name:i.name}),confirmText:(0,v.t)("Delete Rule"),priority:"danger"})}}];return(0,V.BX)(k.Z,{children:[(0,V.BX)(K,{isIssueAlert:(0,A.Gm)(i),children:[(0,V.tZ)(M,{children:(0,V.tZ)(D.Z,{title:(0,A.Gm)(i)?(0,v.t)("Issue Alert"):(0,v._N)("Metric Alert Status: [status]",{status:q[null!==(a=null==i||null===(r=i.latestIncident)||void 0===r?void 0:r.status)&&void 0!==a?a:F.vt.CLOSED]}),children:(0,V.tZ)(_.Z,{status:null==i||null===(n=i.latestIncident)||void 0===n?void 0:n.status,isIssue:(0,A.Gm)(i),hideText:!0})})}),(0,V.BX)(U,{children:[(0,V.tZ)(Y,{children:C}),(0,V.tZ)(H,{children:!(0,A.Gm)(i)&&((0,A.Gm)(i)?null:i.latestIncident?h?(0,V.BX)("div",{children:[(0,v.t)("Triggered "),(0,V.tZ)($.Z,{date:i.latestIncident.dateCreated})]}):(0,V.BX)("div",{children:[(0,v.t)("Resolved "),(0,V.tZ)($.Z,{date:i.latestIncident.dateClosed})]}):"-")})]})]}),(0,V.tZ)(M,{children:function(){var e,t;if((0,A.Gm)(i))return null;const s=i.triggers.find((e=>{let{label:t}=e;return t===X.F4.CRITICAL})),a=i.triggers.find((e=>{let{label:t}=e;return t===X.F4.WARNING})),r=i.resolveThreshold,n=h&&(null===(e=i.latestIncident)||void 0===e?void 0:e.status)===F.vt.CRITICAL?s:null!=a?a:s;let o,l="green300",d=h&&i.thresholdType===X.lT.ABOVE?(0,v.t)("Above"):(0,v.t)("Below");return h?(l=(null==n?void 0:n.label)===X.F4.CRITICAL?"red300":(null==n?void 0:n.label)===X.F4.WARNING?"yellow300":"green300",o=i.thresholdType===X.lT.ABOVE?"up":"down"):(o=i.thresholdType===X.lT.ABOVE?"down":"up",d=i.thresholdType===X.lT.ABOVE?(0,v.t)("Below"):(0,v.t)("Above")),(0,V.BX)(M,{children:[(0,V.tZ)(Z.CC,{color:l,direction:o}),(0,V.tZ)(te,{children:`${d} ${i.latestIncident||!i.latestIncident&&!r?null==n||null===(t=n.alertThreshold)||void 0===t?void 0:t.toLocaleString():null==r?void 0:r.toLocaleString()}`})]})}()}),(0,V.tZ)(M,{children:(0,V.tZ)(J,{children:(0,V.tZ)(Q,{avatarSize:18,project:l?W(g,d):{slug:g}})})}),(0,V.tZ)(M,{children:f?(0,V.tZ)(j.Z,{actor:f,size:24}):"-"}),(0,V.tZ)(M,{children:(0,V.tZ)(ee,{date:(0,G.Z)({value:i.dateCreated,fixed:new Date("2021-04-20")}),format:"ll"})}),(0,V.tZ)(se,{children:(0,V.tZ)(T.Z,{access:["alerts:write"],children:e=>{let{hasAccess:t}=e;return(0,V.tZ)(R.Z,{items:L,placement:"bottom right",triggerProps:{"aria-label":(0,v.t)("Show more"),size:"xsmall",icon:(0,V.tZ)(Z.YR,{size:"xs"}),showChevron:!1},disabledKeys:t&&b?[]:["delete"]})}})})]})}O.displayName="RuleListRow";const P=(0,r.Z)(u.Z,{target:"e1f6xqs310"})(E.Z,";"),M=(0,r.Z)("div",{target:"e1f6xqs39"})({name:"s5xdrg",styles:"display:flex;align-items:center"}),K=(0,r.Z)(M,{target:"e1f6xqs38"})("position:relative;",(e=>e.isIssueAlert&&`padding: ${(0,N.Z)(3)} ${(0,N.Z)(2)}; line-height: 2.4;`),";"),U=(0,r.Z)("div",{target:"e1f6xqs37"})(E.Z," margin-left:",(0,N.Z)(2),";line-height:1.35;"),Y=(0,r.Z)("div",{target:"e1f6xqs36"})(E.Z," font-size:",(e=>e.theme.fontSizeLarge),";@media (max-width: ",(e=>e.theme.breakpoints[3]),"){max-width:300px;}@media (max-width: ",(e=>e.theme.breakpoints[2]),"){max-width:165px;}@media (max-width: ",(e=>e.theme.breakpoints[1]),"){max-width:100px;}"),H=(0,r.Z)("div",{target:"e1f6xqs35"})("color:",(e=>e.theme.gray300),";"),J=(0,r.Z)("div",{target:"e1f6xqs34"})({name:"1d3w5wq",styles:"width:100%"}),Q=(0,r.Z)(S.Z,{target:"e1f6xqs33"})({name:"ozd7xs",styles:"flex-shrink:0"}),ee=(0,r.Z)(B.Z,{target:"e1f6xqs32"})("font-variant-numeric:tabular-nums;color:",(e=>e.theme.gray300),";"),te=(0,r.Z)("div",{target:"e1f6xqs31"})("margin-left:",(0,N.Z)(1),";white-space:nowrap;font-variant-numeric:tabular-nums;"),se=(0,r.Z)(M,{target:"e1f6xqs30"})("justify-content:center;padding:",(0,N.Z)(1),";"),ae=O;class re extends d.Z{constructor(){super(...arguments),(0,a.Z)(this,"handleChangeFilter",((e,t)=>{const{router:s,location:a}=this.props,{cursor:r,page:n,...i}=a.query,o=[...t];s.push({pathname:a.pathname,query:{...i,team:o.length?o:""}})})),(0,a.Z)(this,"handleChangeSearch",(e=>{const{router:t,location:s}=this.props,{cursor:a,page:r,...n}=s.query;t.push({pathname:s.pathname,query:{...n,name:e}})})),(0,a.Z)(this,"handleDeleteRule",(async(e,t)=>{const{params:s}=this.props,{orgId:a}=s,r=(0,A.Gm)(t)?"rules":"alert-rules";try{await this.api.requestPromise(`/projects/${a}/${e}/${r}/${t.id}/`,{method:"DELETE"}),this.reloadData()}catch(e){(0,l.Iw)((0,v.t)("Error deleting rule"))}}))}getEndpoints(){const{params:e,location:t}=this.props,{query:s}=t;return s.expand=["latestIncident"],s.team=(0,A.LI)(s.team),s.sort||(s.sort=["incident_status","date_triggered"]),[["ruleList",`/organizations/${e&&e.orgId}/combined-rules/`,{query:s}]]}renderLoading(){return this.renderBody()}renderList(){const{params:{orgId:e},location:t,organization:s,router:a}=this.props,{loading:r,ruleList:n=[],ruleListPageLinks:i}=this.state,{query:l}=t,d=new Set(o()(null==n?void 0:n.map((e=>{let{projects:t}=e;return t})))),u={asc:"1"===l.asc,field:l.sort||"date_added"},{cursor:m,page:g,...x}=l,y=u.field.includes("incident_status")||u.field.includes("date_triggered"),b=(0,V.tZ)(Z.CC,{color:"gray300",size:"xs",direction:u.asc?"up":"down"});return(0,V.tZ)(oe,{children:(0,V.BX)(c.or,{fullWidth:!0,children:[(0,V.tZ)(I.Z,{organization:s,location:t,onChangeFilter:this.handleChangeFilter,onChangeSearch:this.handleChangeSearch}),(0,V.tZ)(f.Z,{provideUserTeams:!0,children:a=>{let{initiallyLoaded:i,teams:o}=a;return(0,V.tZ)(de,{headers:[(0,V.BX)(le,{role:"columnheader","aria-sort":"name"!==u.field?"none":u.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...x,asc:"name"===u.field&&u.asc?void 0:"1",sort:"name"}},children:[(0,v.t)("Alert Rule")," ","name"===u.field&&b]},"name"),(0,V.BX)(le,{role:"columnheader","aria-sort":y?u.asc?"ascending":"descending":"none",to:{pathname:t.pathname,query:{...x,asc:y&&!u.asc?"1":void 0,sort:["incident_status","date_triggered"]}},children:[(0,v.t)("Status")," ",y&&b]},"status"),(0,v.t)("Project"),(0,v.t)("Team"),(0,V.BX)(le,{role:"columnheader","aria-sort":"date_added"!==u.field?"none":u.asc?"ascending":"descending",to:{pathname:t.pathname,query:{...x,asc:"date_added"!==u.field||u.asc?void 0:"1",sort:"date_added"}},children:[(0,v.t)("Created")," ","date_added"===u.field&&b]},"dateAdded"),(0,v.t)("Actions")],isLoading:r||!i,isEmpty:0===(null==n?void 0:n.length),emptyMessage:(0,v.t)("No alert rules found for the current query."),emptyAction:(0,V.tZ)(ce,{children:(0,v._N)("Learn more about [link:Alerts]",{link:(0,V.tZ)(p.Z,{href:"https://docs.sentry.io/product/alerts-notifications/metric-alerts/"})})}),children:(0,V.tZ)(w.Z,{orgId:e,slugs:Array.from(d),children:t=>{let{initiallyLoaded:a,projects:r}=t;return n.map((t=>(0,V.tZ)(ae,{projectsLoaded:a,projects:r,rule:t,orgId:e,onDelete:this.handleDeleteRule,organization:s,userTeams:new Set(o.map((e=>e.id)))},`${(0,A.Gm)(t)?"metric":"issue"}-${t.id}`)))}})})}}),(0,V.tZ)(h.Z,{pageLinks:i,onCursor:(e,t,s)=>{let r=x.team;r&&0!==r.length||(r=""),a.push({pathname:t,query:{...x,team:r,cursor:e}})}})]})})}renderBody(){const{params:e,organization:t,router:s}=this.props,{orgId:a}=e;return(0,V.tZ)(x.Z,{title:(0,v.t)("Alerts"),orgSlug:a,children:(0,V.BX)(m.Z,{organization:t,showDateSelector:!1,showEnvironmentSelector:!1,hideGlobalHeader:t.features.includes("selection-filters-v2"),children:[(0,V.tZ)(C.Z,{organization:t,router:s,activeTab:"rules"}),this.renderList()]})})}}class ne extends n.Component{componentDidMount(){this.trackView()}componentDidUpdate(e){var t,s;const{location:a}=this.props;(null===(t=e.location.query)||void 0===t?void 0:t.sort)!==(null===(s=a.query)||void 0===s?void 0:s.sort)&&this.trackView()}trackView(){const{organization:e,location:t}=this.props;(0,y.Z)("alert_rules.viewed",{organization:e,sort:Array.isArray(t.query.sort)?t.query.sort.join(","):t.query.sort})}render(){return(0,V.tZ)(re,{...this.props})}}ne.displayName="AlertRulesListContainer";const ie=(0,b.Z)(ne),oe=(0,r.Z)(c.uT,{target:"eddauwb3"})({name:"108qp7n",styles:"margin-bottom:-20px"}),le=(0,r.Z)(u.Z,{target:"eddauwb2"})({name:"1sbdiq8",styles:"color:inherit;:hover{color:inherit;}"}),de=(0,r.Z)(g.KB,{target:"eddauwb1"})("position:static;overflow:auto;@media (min-width: ",(e=>e.theme.breakpoints[0]),"){overflow:initial;}grid-template-columns:4fr auto 140px 60px 110px auto;white-space:nowrap;font-size:",(e=>e.theme.fontSizeMedium),";"),ce=(0,r.Z)("p",{target:"eddauwb0"})("font-size:",(e=>e.theme.fontSizeLarge),";")}}]);
//# sourceMappingURL=../sourcemaps/app_views_alerts_rules_index_tsx.5b9338727ece851fd59b4424cec0610c.js.map
{"version":3,"file":"chunks/app_views_integrationOrganizationLink_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/narrowLayout.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/integrationOrganizationLink.tsx","webpack:///./app/views/organizationIntegrations/addIntegration.tsx"],"sourcesContent":["import {Component} from 'react';\nimport styled from '@emotion/styled';\n\nimport {logout} from 'sentry/actionCreators/account';\nimport {Client} from 'sentry/api';\nimport {IconSentry} from 'sentry/icons';\nimport {t} from 'sentry/locale';\n\ntype Props = {\n  maxWidth?: string;\n  showLogout?: boolean;\n};\n\nclass NarrowLayout extends Component<Props> {\n  UNSAFE_componentWillMount() {\n    document.body.classList.add('narrow');\n  }\n\n  componentWillUnmount() {\n    this.api.clear();\n    document.body.classList.remove('narrow');\n  }\n\n  private api = new Client();\n\n  handleLogout = () => {\n    logout(this.api).then(() => window.location.assign('/auth/login'));\n  };\n\n  render() {\n    return (\n      <div className=\"app\">\n        <div className=\"pattern-bg\" />\n        <div className=\"container\" style={{maxWidth: this.props.maxWidth}}>\n          <div className=\"box box-modal\">\n            <div className=\"box-header\">\n              <a href=\"/\">\n                <IconSentry size=\"lg\" />\n              </a>\n              {this.props.showLogout && (\n                <a className=\"logout pull-right\" onClick={this.handleLogout}>\n                  <Logout>{t('Sign out')}</Logout>\n                </a>\n              )}\n            </div>\n            <div className=\"box-content with-padding\">{this.props.children}</div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nconst Logout = styled('span')`\n  font-size: 16px;\n`;\n\nexport default NarrowLayout;\n","import * as React from 'react';\n\nimport AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {Fragment} from 'react';\nimport {RouteComponentProps} from 'react-router';\nimport {components} from 'react-select';\nimport styled from '@emotion/styled';\nimport {urlEncode} from '@sentry/utils';\n\nimport {addErrorMessage} from 'sentry/actionCreators/indicator';\nimport Alert from 'sentry/components/alert';\nimport Button from 'sentry/components/button';\nimport Field from 'sentry/components/forms/field';\nimport SelectControl from 'sentry/components/forms/selectControl';\nimport IdBadge from 'sentry/components/idBadge';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport NarrowLayout from 'sentry/components/narrowLayout';\nimport {IconFlag} from 'sentry/icons';\nimport {t, tct} from 'sentry/locale';\nimport {Integration, IntegrationProvider, Organization} from 'sentry/types';\nimport {IntegrationAnalyticsKey} from 'sentry/utils/analytics/integrationAnalyticsEvents';\nimport {\n  getIntegrationFeatureGate,\n  trackIntegrationAnalytics,\n} from 'sentry/utils/integrationUtil';\nimport {singleLineRenderer} from 'sentry/utils/marked';\nimport AsyncView from 'sentry/views/asyncView';\nimport AddIntegration from 'sentry/views/organizationIntegrations/addIntegration';\n\n// installationId present for Github flow\ntype Props = RouteComponentProps<{integrationSlug: string; installationId?: string}, {}>;\n\ntype State = AsyncView['state'] & {\n  organization?: Organization;\n  provider?: IntegrationProvider;\n  selectedOrgSlug?: string;\n};\n\nexport default class IntegrationOrganizationLink extends AsyncView<Props, State> {\n  disableErrorReport = false;\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    return [['organizations', '/organizations/']];\n  }\n\n  getTitle() {\n    return t('Choose Installation Organization');\n  }\n\n  trackIntegrationAnalytics = (\n    eventName: IntegrationAnalyticsKey,\n    startSession?: boolean\n  ) => {\n    const {organization, provider} = this.state;\n    // should have these set but need to make TS happy\n    if (!organization || !provider) {\n      return;\n    }\n\n    trackIntegrationAnalytics(\n      eventName,\n      {\n        integration_type: 'first_party',\n        integration: provider.key,\n        // We actually don't know if it's installed but neither does the user in the view and multiple installs is possible\n        already_installed: false,\n        view: 'external_install',\n        organization,\n      },\n      {startSession: !!startSession}\n    );\n  };\n\n  trackOpened() {\n    this.trackIntegrationAnalytics('integrations.integration_viewed', true);\n  }\n\n  trackInstallationStart() {\n    this.trackIntegrationAnalytics('integrations.installation_start');\n  }\n\n  get integrationSlug() {\n    return this.props.params.integrationSlug;\n  }\n\n  get queryParams() {\n    return this.props.location.query;\n  }\n\n  getOrgBySlug = (orgSlug: string): Organization | undefined => {\n    return this.state.organizations.find((org: Organization) => org.slug === orgSlug);\n  };\n\n  onLoadAllEndpointsSuccess() {\n    // auto select the org if there is only one\n    const {organizations} = this.state;\n    if (organizations.length === 1) {\n      this.onSelectOrg({value: organizations[0].slug});\n    }\n  }\n\n  onSelectOrg = async ({value: orgSlug}: {value: string}) => {\n    this.setState({selectedOrgSlug: orgSlug, reloading: true, organization: undefined});\n\n    try {\n      const [organization, {providers}]: [\n        Organization,\n        {providers: IntegrationProvider[]}\n      ] = await Promise.all([\n        this.api.requestPromise(`/organizations/${orgSlug}/`),\n        this.api.requestPromise(\n          `/organizations/${orgSlug}/config/integrations/?provider_key=${this.integrationSlug}`\n        ),\n      ]);\n      // should never happen with a valid provider\n      if (providers.length === 0) {\n        throw new Error('Invalid provider');\n      }\n      this.setState(\n        {organization, reloading: false, provider: providers[0]},\n        this.trackOpened\n      );\n    } catch (_err) {\n      addErrorMessage(t('Failed to retrieve organization or integration details'));\n      this.setState({reloading: false});\n    }\n  };\n\n  hasAccess = () => {\n    const {organization} = this.state;\n    return organization?.access.includes('org:integrations');\n  };\n\n  // used with Github to redirect to the the integration detail\n  onInstallWithInstallationId = (data: Integration) => {\n    const {organization} = this.state;\n    const orgId = organization && organization.slug;\n    this.props.router.push(\n      `/settings/${orgId}/integrations/${data.provider.key}/${data.id}/`\n    );\n  };\n\n  // non-Github redirects to the extension view where the backend will finish the installation\n  finishInstallation = () => {\n    // add the selected org to the query parameters and then redirect back to configure\n    const {selectedOrgSlug} = this.state;\n    const query = {orgSlug: selectedOrgSlug, ...this.queryParams};\n    this.trackInstallationStart();\n    window.location.assign(\n      `/extensions/${this.integrationSlug}/configure/?${urlEncode(query)}`\n    );\n  };\n\n  renderAddButton() {\n    const {installationId} = this.props.params;\n    const {organization, provider} = this.state;\n    // should never happen but we need this check for TS\n    if (!provider || !organization) {\n      return null;\n    }\n    const {features} = provider.metadata;\n\n    // Prepare the features list\n    const featuresComponents = features.map(f => ({\n      featureGate: f.featureGate,\n      description: (\n        <FeatureListItem\n          dangerouslySetInnerHTML={{__html: singleLineRenderer(f.description)}}\n        />\n      ),\n    }));\n\n    const {IntegrationDirectoryFeatures} = getIntegrationFeatureGate();\n\n    // Github uses a different installation flow with the installationId as a parameter\n    // We have to wrap our installation button with AddIntegration so we can get the\n    // addIntegrationWithInstallationId callback.\n    // if we don't hve an installationId, we need to use the finishInstallation callback.\n    return (\n      <IntegrationDirectoryFeatures\n        organization={organization}\n        features={featuresComponents}\n      >\n        {({disabled}) => (\n          <AddIntegration\n            provider={provider}\n            onInstall={this.onInstallWithInstallationId}\n            organization={organization}\n          >\n            {addIntegrationWithInstallationId => (\n              <ButtonWrapper>\n                <Button\n                  priority=\"primary\"\n                  disabled={!this.hasAccess() || disabled}\n                  onClick={() =>\n                    installationId\n                      ? addIntegrationWithInstallationId({\n                          installation_id: installationId,\n                        })\n                      : this.finishInstallation()\n                  }\n                >\n                  {t('Install %s', provider.name)}\n                </Button>\n              </ButtonWrapper>\n            )}\n          </AddIntegration>\n        )}\n      </IntegrationDirectoryFeatures>\n    );\n  }\n\n  customOption = orgProps => {\n    const organization = this.getOrgBySlug(orgProps.value);\n    if (!organization) {\n      return null;\n    }\n    return (\n      <components.Option {...orgProps}>\n        <IdBadge\n          organization={organization}\n          avatarSize={20}\n          displayName={organization.name}\n          avatarProps={{consistentWidth: true}}\n        />\n      </components.Option>\n    );\n  };\n\n  customValueContainer = containerProps => {\n    const valueList = containerProps.getValue();\n    // if no value set, we want to return the default component that is rendered\n    if (valueList.length === 0) {\n      return <components.ValueContainer {...containerProps} />;\n    }\n    const orgSlug = valueList[0].value;\n    const organization = this.getOrgBySlug(orgSlug);\n    if (!organization) {\n      return <components.ValueContainer {...containerProps} />;\n    }\n    return (\n      <components.ValueContainer {...containerProps}>\n        <IdBadge\n          organization={organization}\n          avatarSize={20}\n          displayName={organization.name}\n          avatarProps={{consistentWidth: true}}\n        />\n      </components.ValueContainer>\n    );\n  };\n\n  renderBottom() {\n    const {organization, selectedOrgSlug, provider, reloading} = this.state;\n    const {FeatureList} = getIntegrationFeatureGate();\n    if (reloading) {\n      return <LoadingIndicator />;\n    }\n\n    return (\n      <Fragment>\n        {selectedOrgSlug && organization && !this.hasAccess() && (\n          <Alert type=\"error\" icon={<IconFlag size=\"md\" />}>\n            <p>\n              {tct(\n                `You do not have permission to install integrations in\n                [organization]. Ask an organization owner or manager to\n                visit this page to finish installing this integration.`,\n                {organization: <strong>{organization.slug}</strong>}\n              )}\n            </p>\n            <InstallLink>{window.location.href}</InstallLink>\n          </Alert>\n        )}\n\n        {provider && organization && this.hasAccess() && FeatureList && (\n          <Fragment>\n            <p>\n              {tct(\n                'The following features will be available for [organization] when installed.',\n                {organization: <strong>{organization.slug}</strong>}\n              )}\n            </p>\n            <FeatureList\n              organization={organization}\n              features={provider.metadata.features}\n              provider={provider}\n            />\n          </Fragment>\n        )}\n\n        <div className=\"form-actions\">{this.renderAddButton()}</div>\n      </Fragment>\n    );\n  }\n\n  renderBody() {\n    const {selectedOrgSlug} = this.state;\n    const options = this.state.organizations.map((org: Organization) => ({\n      value: org.slug,\n      label: org.name,\n    }));\n\n    return (\n      <NarrowLayout>\n        <h3>{t('Finish integration installation')}</h3>\n        <p>\n          {tct(\n            `Please pick a specific [organization:organization] to link with\n            your integration installation of [integation].`,\n            {\n              organization: <strong />,\n              integation: <strong>{this.integrationSlug}</strong>,\n            }\n          )}\n        </p>\n\n        <Field label={t('Organization')} inline={false} stacked required>\n          <SelectControl\n            onChange={this.onSelectOrg}\n            value={selectedOrgSlug}\n            placeholder={t('Select an organization')}\n            options={options}\n            components={{\n              Option: this.customOption,\n              ValueContainer: this.customValueContainer,\n            }}\n          />\n        </Field>\n        {this.renderBottom()}\n      </NarrowLayout>\n    );\n  }\n}\n\nconst InstallLink = styled('pre')`\n  margin-bottom: 0;\n  background: #fbe3e1;\n`;\n\nconst FeatureListItem = styled('span')`\n  line-height: 24px;\n`;\n\nconst ButtonWrapper = styled('div')`\n  margin-left: auto;\n  align-self: center;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n","import * as React from 'react';\nimport * as qs from 'query-string';\n\nimport {addErrorMessage, addSuccessMessage} from 'sentry/actionCreators/indicator';\nimport {t} from 'sentry/locale';\nimport {IntegrationProvider, IntegrationWithConfig, Organization} from 'sentry/types';\nimport {trackIntegrationAnalytics} from 'sentry/utils/integrationUtil';\n\ntype Props = {\n  children: (\n    openDialog: (urlParams?: {[key: string]: string}) => void\n  ) => React.ReactNode;\n  onInstall: (data: IntegrationWithConfig) => void;\n  organization: Organization;\n  provider: IntegrationProvider;\n  account?: string; // for analytics\n  analyticsParams?: {\n    already_installed: boolean;\n    view:\n      | 'integrations_directory_integration_detail'\n      | 'integrations_directory'\n      | 'onboarding'\n      | 'project_creation';\n  };\n  modalParams?: {[key: string]: string};\n};\n\nexport default class AddIntegration extends React.Component<Props> {\n  componentDidMount() {\n    window.addEventListener('message', this.didReceiveMessage);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('message', this.didReceiveMessage);\n    this.dialog && this.dialog.close();\n  }\n\n  dialog: Window | null = null;\n\n  computeCenteredWindow(width: number, height: number) {\n    // Taken from: https://stackoverflow.com/questions/4068373/center-a-popup-window-on-screen\n    const screenLeft =\n      window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n\n    const screenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n\n    const innerWidth = window.innerWidth\n      ? window.innerWidth\n      : document.documentElement.clientWidth\n      ? document.documentElement.clientWidth\n      : screen.width;\n\n    const innerHeight = window.innerHeight\n      ? window.innerHeight\n      : document.documentElement.clientHeight\n      ? document.documentElement.clientHeight\n      : screen.height;\n\n    const left = innerWidth / 2 - width / 2 + screenLeft;\n    const top = innerHeight / 2 - height / 2 + screenTop;\n\n    return {left, top};\n  }\n\n  openDialog = (urlParams?: {[key: string]: string}) => {\n    const {account, analyticsParams, modalParams, organization, provider} = this.props;\n\n    trackIntegrationAnalytics('integrations.installation_start', {\n      integration: provider.key,\n      integration_type: 'first_party',\n      organization,\n      ...analyticsParams,\n    });\n    const name = 'sentryAddIntegration';\n    const {url, width, height} = provider.setupDialog;\n    const {left, top} = this.computeCenteredWindow(width, height);\n\n    let query: {[key: string]: string} = {...urlParams};\n\n    if (account) {\n      query.account = account;\n    }\n\n    if (modalParams) {\n      query = {...query, ...modalParams};\n    }\n\n    const installUrl = `${url}?${qs.stringify(query)}`;\n    const opts = `scrollbars=yes,width=${width},height=${height},top=${top},left=${left}`;\n\n    this.dialog = window.open(installUrl, name, opts);\n    this.dialog && this.dialog.focus();\n  };\n\n  didReceiveMessage = (message: MessageEvent) => {\n    const {analyticsParams, onInstall, organization, provider} = this.props;\n\n    if (message.origin !== document.location.origin) {\n      return;\n    }\n\n    if (message.source !== this.dialog) {\n      return;\n    }\n\n    const {success, data} = message.data;\n    this.dialog = null;\n\n    if (!success) {\n      addErrorMessage(data.error);\n      return;\n    }\n\n    if (!data) {\n      return;\n    }\n    trackIntegrationAnalytics('integrations.installation_complete', {\n      integration: provider.key,\n      integration_type: 'first_party',\n      organization,\n      ...analyticsParams,\n    });\n    addSuccessMessage(t('%s added', provider.name));\n    onInstall(data);\n  };\n\n  render() {\n    const {children} = this.props;\n\n    return children(this.openDialog);\n  }\n}\n"],"names":["NarrowLayout","Component","Client","logout","this","api","then","window","location","assign","UNSAFE_componentWillMount","document","body","classList","add","componentWillUnmount","clear","remove","render","className","style","maxWidth","props","href","size","showLogout","onClick","handleLogout","Logout","t","children","AsyncView","AsyncComponent","getTitle","title","renderComponent","IntegrationOrganizationLink","eventName","startSession","organization","provider","state","trackIntegrationAnalytics","integration_type","integration","key","already_installed","view","orgSlug","organizations","find","org","slug","async","value","setState","selectedOrgSlug","reloading","undefined","providers","Promise","all","requestPromise","integrationSlug","length","Error","trackOpened","_err","addErrorMessage","access","includes","data","orgId","router","push","id","query","queryParams","trackInstallationStart","urlEncode","orgProps","getOrgBySlug","avatarSize","displayName","name","avatarProps","consistentWidth","containerProps","valueList","getValue","getEndpoints","params","onLoadAllEndpointsSuccess","onSelectOrg","renderAddButton","installationId","features","metadata","featuresComponents","map","f","featureGate","description","FeatureListItem","dangerouslySetInnerHTML","__html","singleLineRenderer","IntegrationDirectoryFeatures","getIntegrationFeatureGate","disabled","onInstall","onInstallWithInstallationId","addIntegrationWithInstallationId","ButtonWrapper","priority","hasAccess","installation_id","finishInstallation","renderBottom","FeatureList","Fragment","type","icon","tct","InstallLink","renderBody","options","label","integation","inline","stacked","required","onChange","placeholder","components","Option","customOption","ValueContainer","customValueContainer","AddIntegration","React","urlParams","account","analyticsParams","modalParams","url","width","height","setupDialog","left","top","computeCenteredWindow","installUrl","qs","opts","dialog","open","focus","message","origin","source","success","addSuccessMessage","error","componentDidMount","addEventListener","didReceiveMessage","removeEventListener","close","screenLeft","screenX","screenTop","screenY","innerWidth","documentElement","clientWidth","screen","innerHeight","clientHeight","openDialog"],"sourceRoot":""}
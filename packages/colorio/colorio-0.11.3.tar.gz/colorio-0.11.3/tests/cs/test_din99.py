import numpy as np
import pytest

import colorio


@pytest.mark.parametrize(
    "lab,ref",
    [
        # reference values from <https://de.wikipedia.org/wiki/DIN99-Farbraum>
        ([50, 10, 10], [61.42957005065451, 9.69880364042431, 3.763294252305096]),
        ([50, 50, 50], [61.42957005065451, 28.643406598745752, 11.11410967948868]),
        ([50, -10, 10], [61.42957005065451, -5.5659005500400385, 7.028805275354587]),
        ([50, -50, 50], [61.42957005065451, -17.223109841824353, 21.74991885425549]),
        ([50, -10, -10], [61.42957005065451, -9.698803640424204, -3.7632942523051636]),
        ([50, -50, -50], [61.42957005065451, -28.64340659874571, -11.114109679488735]),
        ([50, +50, -10], [61.42957005065451, 24.09788147190708, -8.710194442180885]),
        ([50, +50, -50], [61.42957005065451, 17.2231098418244, -21.749918854255508]),
        ([0, 0, 0], [0.0, 0.0, 0.0]),
        ([100, 0, 0], [100.00125948147634, 0.0, 0.0]),
    ],
)
def test_reference_lab(lab, ref):
    print(lab)
    xyz100 = colorio.cs.CIELAB().to_xyz100(lab)
    cs = colorio.cs.DIN99()
    val = cs.from_xyz100(xyz100)
    print(list(val))
    assert np.all(np.abs(val - ref) < 1.0e-13 * np.abs(ref) + 1.0e-12)


@pytest.mark.parametrize(
    "variant,lab,ref",
    [
        (None, [50, 10, 10], [61.42957005065451, 9.69880364042431, 3.763294252305096]),
        (
            None,
            [50, 50, 50],
            [61.42957005065451, 28.643406598745752, 11.11410967948868],
        ),
        (
            "b",
            [50, 10, 10],
            [54.097652115399505, 12.22099349532196, 10.984346373336434],
        ),
        (
            "b",
            [50, 50, 50],
            [54.097652115399505, 31.25222642295921, 28.089801381461438],
        ),
        (
            "c",
            [50, 10, 10],
            [53.91879234759052, 10.807656237627247, 10.159196863369411],
        ),
        (
            "c",
            [50, 50, 50],
            [53.91879234759052, 28.657231369781876, 26.937797487594885],
        ),
        ("d", [50, 10, 10], [53.8286056816764, 9.901245941535018, 9.66367962619275]),
        ("d", [50, 50, 50], [53.8286056816764, 26.69284939902275, 26.052392438843064]),
    ],
)
def test_variants(variant, lab, ref):
    print(variant)
    print(lab)
    xyz100 = colorio.cs.CIELAB().to_xyz100(lab)
    cs = colorio.cs.DIN99(variant=variant)
    val = cs.from_xyz100(xyz100)
    print(list(val))
    assert np.all(np.abs(val - ref) < 1.0e-13 * np.abs(ref) + 1.0e-12)

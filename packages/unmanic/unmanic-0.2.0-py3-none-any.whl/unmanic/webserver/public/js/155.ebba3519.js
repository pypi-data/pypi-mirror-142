(self["webpackChunkunmanic_frontend"]=self["webpackChunkunmanic_frontend"]||[]).push([[155],{155:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>re});var l=s(3673),o=s(2323);const a={class:"q-pa-none"},n={class:"row"},i={class:"col q-ma-sm"},r={class:"q-pa-md",style:{"max-width":"500px"}},u={class:"q-mb-none"},d={class:"q-gutter-sm"},c={class:"q-mb-none"},m={class:"q-gutter-sm"},h={class:"text-weight-bold"},p={class:"text-weight-bold"},w={class:"text-grey-8 q-gutter-xs"},k={class:"text-h6"},g={class:"row items-center justify-end"},b={class:"q-mb-none"},f={class:"q-gutter-sm"},y={key:0},W={class:"row"},v={class:"col-6 text-center"},_={class:"col-6 text-center"};function q(e,t,s,q,$,C){const T=(0,l.up)("q-skeleton"),x=(0,l.up)("q-input"),V=(0,l.up)("q-slider"),L=(0,l.up)("q-separator"),Q=(0,l.up)("q-tooltip"),S=(0,l.up)("q-icon"),Z=(0,l.up)("q-avatar"),P=(0,l.up)("q-item-section"),U=(0,l.up)("q-item-label"),z=(0,l.up)("q-btn"),j=(0,l.up)("q-item"),O=(0,l.up)("draggable"),H=(0,l.up)("q-list"),I=(0,l.up)("q-space"),D=(0,l.up)("q-bar"),B=(0,l.up)("q-card-section"),E=(0,l.up)("q-select"),A=(0,l.up)("q-time"),F=(0,l.up)("q-popup-proxy"),J=(0,l.up)("q-card-actions"),N=(0,l.up)("q-card"),G=(0,l.up)("q-dialog"),K=(0,l.up)("q-form"),M=(0,l.up)("q-page"),R=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.j4)(M,{padding:""},{default:(0,l.w5)((()=>[(0,l.Wm)("div",a,[(0,l.Wm)("div",n,[(0,l.Wm)("div",i,[(0,l.Wm)("div",r,[(0,l.Wm)(K,{onSubmit:C.save,class:"q-gutter-md"},{default:(0,l.w5)((()=>[(0,l.Wm)("h5",u,(0,o.zw)(e.$t("components.settings.workers.workerCount")),1),(0,l.Wm)("div",d,[null===$.workerCount?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"QInput"})):(0,l.kq)("",!0),null!==$.workerCount?((0,l.wg)(),(0,l.j4)(x,{key:1,readonly:"",outlined:"",color:"primary",modelValue:$.workerCount,"onUpdate:modelValue":t[1]||(t[1]=e=>$.workerCount=e),label:e.$t("components.settings.workers.workerCount"),placeholder:$.workerCount},null,8,["modelValue","label","placeholder"])):(0,l.kq)("",!0),null===$.workerCount?((0,l.wg)(),(0,l.j4)(T,{key:2,type:"QSlider"})):(0,l.kq)("",!0),null!==$.workerCount?((0,l.wg)(),(0,l.j4)(V,{key:3,modelValue:$.workerCount,"onUpdate:modelValue":t[2]||(t[2]=e=>$.workerCount=e),min:0,max:12,color:"primary"},null,8,["modelValue"])):(0,l.kq)("",!0)]),(0,l.Wm)(L,{class:"q-my-lg"}),(0,l.Wm)("h5",c,(0,o.zw)(e.$t("components.settings.workers.schedule")),1),(0,l.Wm)("div",m,[null===$.cachePath?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"text"})):(0,l.kq)("",!0),(0,l.Wm)(H,{bordered:"",separator:"",class:"rounded-borders"},{default:(0,l.w5)((()=>[(0,l.Wm)(O,(0,l.dG)({class:"schedule-list-group","item-key":"order",tag:"transition-group","component-data":{tag:"ul",name:"flip-list",type:"transition"},modelValue:$.schedules,"onUpdate:modelValue":t[3]||(t[3]=e=>$.schedules=e)},C.dragOptions),{item:(0,l.w5)((({element:t,index:s})=>[(0,l.Wm)(j,{key:s,class:"q-pa-none rounded-borders","active-class":"schedule-list-item"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{avatar:"",class:"q-px-sm q-mx-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,{rounded:""},{default:(0,l.w5)((()=>[(0,l.Wm)(S,{name:"drag_handle",class:"",style:{"max-width":"30px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.move")),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,l.Wm)(L,{inset:"",vertical:"",class:"q-mr-sm"}),(0,l.Wm)(P,{class:"q-px-sm q-mx-sm"},{default:(0,l.w5)((()=>[(0,l.Wm)(U,{lines:"1"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(t.repetitionLabel)+" @ "+(0,o.zw)(t.scheduleTime),1)])),_:2},1024),"count"===t.scheduleTask?((0,l.wg)(),(0,l.j4)(U,{key:0,caption:"",lines:"2"},{default:(0,l.w5)((()=>[(0,l.Wm)("span",h,(0,o.zw)(t.scheduleTaskLabel),1),(0,l.Uk)(" = "+(0,o.zw)(t.scheduleWorkerCount),1)])),_:2},1024)):((0,l.wg)(),(0,l.j4)(U,{key:1,caption:"",lines:"2"},{default:(0,l.w5)((()=>[(0,l.Wm)("span",p,(0,o.zw)(t.scheduleTaskLabel),1)])),_:2},1024))])),_:2},1024),(0,l.Wm)(L,{inset:"",vertical:"",class:"q-mx-sm"}),(0,l.Wm)(P,{center:"",side:""},{default:(0,l.w5)((()=>[(0,l.Wm)("div",w,[(0,l.Wm)(z,{flat:"",dense:"",round:"",size:"12px",color:"negative",icon:"delete",onClick:e=>C.deleteSchedule(s)},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.delete")),1)])),_:1})])),_:2},1032,["onClick"])])])),_:2},1024)])),_:2},1024)])),_:1},16,["modelValue"])])),_:1}),(0,l.Wm)(D,{class:"bg-transparent"},{default:(0,l.w5)((()=>[(0,l.Wm)(I),(0,l.Wm)(z,{round:"",flat:"",color:"primary",icon:"add",onClick:t[4]||(t[4]=e=>$.newSchedule=!0)},{default:(0,l.w5)((()=>[(0,l.Wm)(Q,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("tooltips.add")),1)])),_:1})])),_:1})])),_:1}),(0,l.Wm)(G,{modelValue:$.newSchedule,"onUpdate:modelValue":t[10]||(t[10]=e=>$.newSchedule=e),persistent:""},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{style:{"min-width":"350px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(B,null,{default:(0,l.w5)((()=>[(0,l.Wm)("div",k,(0,o.zw)(e.$t("components.settings.workers.newScheduledEvent")),1)])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{filled:"",modelValue:$.repetition,"onUpdate:modelValue":t[5]||(t[5]=e=>$.repetition=e),options:$.repetitionOptions,label:e.$t("components.settings.workers.repetition")},null,8,["modelValue","options","label"])])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{filled:"",modelValue:$.scheduleTime,"onUpdate:modelValue":t[7]||(t[7]=e=>$.scheduleTime=e),mask:"time"},{append:(0,l.w5)((()=>[(0,l.Wm)(S,{name:"access_time",class:"cursor-pointer"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{"transition-show":"scale","transition-hide":"scale"},{default:(0,l.w5)((()=>[(0,l.Wm)(A,{modelValue:$.scheduleTime,"onUpdate:modelValue":t[6]||(t[6]=e=>$.scheduleTime=e)},{default:(0,l.w5)((()=>[(0,l.Wm)("div",g,[(0,l.wy)((0,l.Wm)(z,{label:e.$t("navigation.close"),color:"primary",flat:""},null,8,["label"]),[[R]])])])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(B,{class:"q-pt-none"},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{filled:"",modelValue:$.scheduleTask,"onUpdate:modelValue":t[8]||(t[8]=e=>$.scheduleTask=e),options:$.scheduleTaskOptions,label:e.$t("components.settings.workers.task")},null,8,["modelValue","options","label"])])),_:1}),"count"===$.scheduleTask.value?((0,l.wg)(),(0,l.j4)(B,{key:0,class:"q-pt-none q-mt-md q-mx-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{modelValue:$.scheduleWorkerCount,"onUpdate:modelValue":t[9]||(t[9]=e=>$.scheduleWorkerCount=e),min:0,max:12,label:"","label-value":"Worker count: "+$.scheduleWorkerCount,"label-always":"",color:"primary"},null,8,["modelValue","label-value"])])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(J,{align:"right",class:"text-primary"},{default:(0,l.w5)((()=>[(0,l.wy)((0,l.Wm)(z,{flat:"",label:e.$t("navigation.cancel")},null,8,["label"]),[[R]]),(0,l.wy)((0,l.Wm)(z,{onClick:C.addNewScheduledEvent,flat:"",label:e.$t("components.settings.workers.addEvent")},null,8,["onClick","label"]),[[R]])])),_:1})])),_:1})])),_:1},8,["modelValue"])]),(0,l.Wm)(L,{class:"q-my-lg"}),(0,l.Wm)("h5",b,(0,o.zw)(e.$t("components.settings.workers.path")),1),(0,l.Wm)("div",f,[null===$.cachePath?((0,l.wg)(),(0,l.j4)(T,{key:0,type:"QInput"})):((0,l.wg)(),(0,l.j4)(x,{key:1,readonly:"",outlined:"",color:"primary",modelValue:$.cachePath,"onUpdate:modelValue":t[11]||(t[11]=e=>$.cachePath=e),label:e.$t("components.settings.workers.path"),placeholder:$.cachePath,onClick:C.updateLibraryWithDirectoryBrowser},{append:(0,l.w5)((()=>[(0,l.Wm)(S,{onClick:C.updateLibraryWithDirectoryBrowser,class:"cursor-pointer",name:"folder_open"},null,8,["onClick"])])),_:1},8,["modelValue","label","placeholder","onClick"]))]),(0,l.Wm)("div",null,[(0,l.Wm)(z,{label:e.$t("navigation.submit"),type:"submit",color:"secondary"},null,8,["label"])])])),_:1},8,["onSubmit"])])])]),e.$q.platform.is.mobile?((0,l.wg)(),(0,l.j4)("div",y,[(0,l.Wm)(L,{class:"q-mb-lg"}),(0,l.Wm)("div",W,[(0,l.Wm)("div",v,[(0,l.Wm)(N,{flat:"",bordered:"",onClick:t[12]||(t[12]=t=>e.$router.push("/ui/settings-library")),class:"q-ma-xs"},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{icon:"navigate_before",flat:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("navigation.library")),1)])),_:1})])),_:1})]),(0,l.Wm)("div",_,[(0,l.Wm)(N,{flat:"",bordered:"",onClick:t[13]||(t[13]=t=>e.$router.push("/ui/settings-plugins")),class:"q-ma-xs"},{default:(0,l.w5)((()=>[(0,l.Wm)(z,{"icon-right":"navigate_next",flat:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.$t("navigation.plugins")),1)])),_:1})])),_:1})])])])):(0,l.kq)("",!0)])])),_:1})}var $=s(4190),C=s(1959),T=s(8825),x=s(5948),V=s(5625),L=s(52),Q=s.n(L),S=s(470),Z=s.n(S),P=s(7689);const U={name:"SettingsWorkers",components:{draggable:Z()},setup(){(0,T.Z)();const{t:e}=(0,x.QT)();let t=null,s=(0,$.A)(e);function o(){t=s.init()}function a(){s.close()}(0,l.bv)((()=>{o()})),(0,l.Ah)((()=>{a()}))},data(){return{workerCount:(0,C.iH)(null),cachePath:(0,C.iH)(null),schedules:(0,C.iH)([]),newSchedule:(0,C.iH)(!1),repetition:(0,C.iH)(""),repetitionOptions:[{label:this.$t("components.settings.workers.scheduleLabels.daily"),value:"daily"},{label:this.$t("components.settings.workers.scheduleLabels.weekday"),value:"weekday"},{label:this.$t("components.settings.workers.scheduleLabels.weekend"),value:"weekend"},{label:this.$t("components.settings.workers.scheduleLabels.monday"),value:"monday"},{label:this.$t("components.settings.workers.scheduleLabels.tuesday"),value:"tuesday"},{label:this.$t("components.settings.workers.scheduleLabels.wednesday"),value:"wednesday"},{label:this.$t("components.settings.workers.scheduleLabels.thursday"),value:"thursday"},{label:this.$t("components.settings.workers.scheduleLabels.friday"),value:"friday"},{label:this.$t("components.settings.workers.scheduleLabels.saturday"),value:"saturday"},{label:this.$t("components.settings.workers.scheduleLabels.sunday"),value:"sunday"}],scheduleTime:(0,C.iH)("00:00"),scheduleTask:(0,C.iH)(""),scheduleTaskOptions:[{label:this.$t("components.settings.workers.scheduleLabels.count"),value:"count"},{label:this.$t("components.settings.workers.scheduleLabels.pause"),value:"pause"},{label:this.$t("components.settings.workers.scheduleLabels.resume"),value:"resume"}],scheduleWorkerCount:(0,C.iH)(1)}},methods:{updateLibraryWithDirectoryBrowser:function(){this.$q.dialog({component:V.Z,componentProps:{dialogHeader:this.$t("headers.selectDirectory"),initialPath:this.cachePath,listType:"directories"}}).onOk((e=>{"undefined"!==typeof e.selectedPath&&null!==e.selectedPath&&(this.cachePath=e.selectedPath)})).onDismiss((()=>{}))},fetchSettings:function(){Q()({method:"get",url:(0,P.J4)("v2","settings/read")}).then((e=>{this.workerCount=e.data.settings.number_of_workers;let t=[];for(let s=0;s<e.data.settings.worker_event_schedules.length;s++){let l=e.data.settings.worker_event_schedules[s];t[t.length]={repetition:l.repetition,repetitionLabel:this.$t("components.settings.workers.scheduleLabels."+l.repetition),scheduleTime:l.schedule_time,scheduleTask:l.schedule_task,scheduleTaskLabel:this.$t("components.settings.workers.scheduleLabels."+l.schedule_task),scheduleWorkerCount:l.schedule_worker_count}}this.schedules=t,this.cachePath=e.data.settings.cache_path})).catch((()=>{this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.failedToFetchSettings"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})}))},save:function(){let e=[];for(let s=0;s<this.schedules.length;s++)e[e.length]={repetition:this.schedules[s].repetition,schedule_time:this.schedules[s].scheduleTime,schedule_task:this.schedules[s].scheduleTask,schedule_worker_count:this.schedules[s].scheduleWorkerCount};let t={settings:{number_of_workers:this.workerCount,cache_path:this.cachePath,worker_event_schedules:e}};Q()({method:"post",url:(0,P.J4)("v2","settings/write"),data:t}).then((e=>{this.fetchSettings(),this.$q.notify({color:"positive",position:"top",icon:"cloud_done",message:this.$t("notifications.saved"),timeout:200})})).catch((()=>{this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.failedToSaveSettings"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})}))},addNewScheduledEvent:function(){"undefined"!==typeof this.repetition.value&&"undefined"!==typeof this.scheduleTask.value?this.schedules[this.schedules.length]={repetition:this.repetition.value,repetitionLabel:this.$t("components.settings.workers.scheduleLabels."+this.repetition.value),scheduleTime:this.scheduleTime,scheduleTask:this.scheduleTask.value,scheduleTaskLabel:this.$t("components.settings.workers.scheduleLabels."+this.scheduleTask.value),scheduleWorkerCount:this.scheduleWorkerCount}:this.$q.notify({color:"negative",position:"top",message:this.$t("notifications.invalidWorkerEvent"),icon:"report_problem",actions:[{icon:"close",color:"white"}]})},deleteSchedule:function(e){let t=[];for(let s=0;s<this.schedules.length;s++)s!==e&&(t[t.length]=this.schedules[s]);this.schedules=t}},created(){this.fetchSettings()},computed:{dragOptions(){return{animation:100,group:"scheduleOrder",disabled:!1,ghostClass:"ghost",direction:"vertical",delay:200,delayOnTouchOnly:!0}}}};var z=s(4379),j=s(5269),O=s(4103),H=s(4842),I=s(2064),D=s(5869),B=s(7011),E=s(3414),A=s(2035),F=s(5096),J=s(4554),N=s(8870),G=s(2350),K=s(2165),M=s(846),R=s(2025),X=s(6778),Y=s(151),ee=s(5589),te=s(8516),se=s(3944),le=s(7886),oe=s(9367),ae=s(677),ne=s(7518),ie=s.n(ne);U.render=q;const re=U;ie()(U,"components",{QPage:z.Z,QForm:j.Z,QSkeleton:O.ZP,QInput:H.Z,QSlider:I.Z,QSeparator:D.Z,QList:B.Z,QItem:E.Z,QItemSection:A.Z,QAvatar:F.Z,QIcon:J.Z,QTooltip:N.Z,QItemLabel:G.Z,QBtn:K.Z,QBar:M.Z,QSpace:R.Z,QDialog:X.Z,QCard:Y.Z,QCardSection:ee.Z,QSelect:te.Z,QPopupProxy:se.Z,QTime:le.Z,QCardActions:oe.Z}),ie()(U,"directives",{ClosePopup:ae.Z})}}]);